<% const setBody = `
<div style="max-width: 600px; margin: 0 auto;">
    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    
    ${typeof error !== 'undefined' && error ? `<p class="error-msg">${error}</p>` : ''}
    ${typeof success !== 'undefined' && success ? `<p style="color: #10b981; margin-bottom: 1rem;">${success}</p>` : ''}

    <div class="card" style="margin-top: 1.5rem;">
        <h3 style="margin-bottom: 1rem;">–í–∞—à –∞–∫–∫–∞—É–Ω—Ç</h3>
        <p><strong>Email:</strong> ${user.email}</p>
        <p><strong>–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω:</strong> <span style="color: var(--primary-color); font-weight: bold;">${user.plan}</span></p>
        
        <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
            <h4 style="margin-bottom: 1rem;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π</h4>
            ${user.plan === 'FREE' ? `
                <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem;">
                    –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ PRO –ø–ª–∞–Ω, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ —É–±—Ä–∞—Ç—å —Ä–µ–∫–ª–∞–º—É.
                </p>
                <form action="/app/settings/upgrade-demo" method="POST">
                    <button type="submit" class="btn btn-primary">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å PRO (–î–µ–º–æ)</button>
                </form>
            ` : `
                <p style="color: #059669; font-weight: 500; margin-bottom: 1rem;">‚úì –£ –≤–∞—Å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω PRO –ø–ª–∞–Ω.</p>
                <button disabled class="btn" style="background: #e5e7eb; cursor: not-allowed;">–í—ã —É–∂–µ PRO</button>
            `}
        </div>
    </div>

    <div class="card">
        <h3 style="margin-bottom: 1.5rem;">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h3>
        <form action="/app/settings/change-password" method="POST" id="changePasswordForm">
            <div class="form-group">
                <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                <div class="password-input-wrapper">
                    <input type="password" name="newPassword" id="newPassword" required>
                    <button type="button" class="password-toggle" id="toggleNewPassword" aria-label="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">
                        üëÅÔ∏è
                    </button>
                </div>
                <ul class="password-requirements">
                    <li id="req-length" class="requirement">–û—Ç 8 –¥–æ 15 —Å–∏–º–≤–æ–ª–æ–≤</li>
                    <li id="req-case" class="requirement">–ü—Ä–æ–ø–∏—Å–Ω—ã–µ –∏ —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã</li>
                    <li id="req-number" class="requirement">–ú–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞</li>
                    <li id="req-special" class="requirement">–ú–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª</li>
                </ul>
            </div>
            
            <div class="form-group">
                <label>–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                <div class="password-input-wrapper">
                    <input type="password" name="confirmPassword" id="confirmPassword" required>
                    <button type="button" class="password-toggle" id="toggleConfirmPassword" aria-label="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">
                        üëÅÔ∏è
                    </button>
                </div>
                <p id="match-error" class="error-msg" style="display: none; font-size: 0.8rem; margin-top: 0.5rem;">–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç</p>
            </div>

            <button type="submit" id="submitBtn" class="btn btn-primary" style="margin-top: 1rem;">–û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const newPasswordInput = document.getElementById('newPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const submitBtn = document.getElementById('submitBtn');
        const matchError = document.getElementById('match-error');
        
        const toggleNew = document.getElementById('toggleNewPassword');
        const toggleConfirm = document.getElementById('toggleConfirmPassword');

        const requirements = {
            length: document.getElementById('req-length'),
            case: document.getElementById('req-case'),
            number: document.getElementById('req-number'),
            special: document.getElementById('req-special')
        };

        function setupToggle(btn, input) {
            btn.addEventListener('click', () => {
                const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                input.setAttribute('type', type);
                btn.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
            });
        }

        setupToggle(toggleNew, newPasswordInput);
        setupToggle(toggleConfirm, confirmPasswordInput);

        function validate() {
            const val = newPasswordInput.value;
            const confirmVal = confirmPasswordInput.value;
            
            const isLengthValid = val.length >= 8 && val.length <= 15;
            requirements.length.classList.toggle('valid', isLengthValid);
            
            const isCaseValid = /[a-z]/.test(val) && /[A-Z]/.test(val);
            requirements.case.classList.toggle('valid', isCaseValid);
            
            const isNumberValid = /\\d/.test(val);
            requirements.number.classList.toggle('valid', isNumberValid);
            
            const isSpecialValid = /[!@#$%^&*(),.?":{}|<>]/.test(val);
            requirements.special.classList.toggle('valid', isSpecialValid);

            const passwordsMatch = val === confirmVal && val !== '';
            
            if (confirmVal !== '') {
                matchError.style.display = passwordsMatch ? 'none' : 'block';
            } else {
                matchError.style.display = 'none';
            }

            const isAllValid = isLengthValid && isCaseValid && isNumberValid && isSpecialValid && passwordsMatch;
            // –ú—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–∞ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è, 
            // –Ω–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –º–æ–∂–µ–º –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å.
        }

        newPasswordInput.addEventListener('input', validate);
        confirmPasswordInput.addEventListener('input', validate);

        document.getElementById('changePasswordForm').addEventListener('submit', (e) => {
            const val = newPasswordInput.value;
            const confirmVal = confirmPasswordInput.value;
            const isAllValid = (val.length >= 8 && val.length <= 15) && 
                              (/[a-z]/.test(val) && /[A-Z]/.test(val)) &&
                              (/\\d/.test(val)) &&
                              (/[!@#$%^&*(),.?":{}|<>]/.test(val)) &&
                              (val === confirmVal);
            
            if (!isAllValid) {
                e.preventDefault();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ –ø–∞—Ä–æ–ª–µ');
            }
        });
    });
</script>
`; %>
<%- include('../layout', { body: setBody }) %>
