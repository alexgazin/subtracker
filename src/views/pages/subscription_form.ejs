<% const formBody = `
<div style="max-width: 600px; margin: 0 auto;">
    <div class="card">
        <h2 style="margin-bottom: 1.5rem;">${sub && sub.id ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–ù–æ–≤–∞—è'} –ø–æ–¥–ø–∏—Å–∫–∞</h2>
        ${error ? `<p class="error-msg">${error}</p>` : ''}
        <form action="${sub && sub.id ? '/app/subscriptions/' + sub.id : '/app/subscriptions'}" method="POST">
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞</label>
                <input type="text" id="serviceName" name="name" placeholder="Netflix, Spotify..." required value="${sub?.name || ''}">
            </div>
            <div class="grid" style="grid-template-columns: 1fr 1fr;">
                <div class="form-group">
                    <label>–¶–µ–Ω–∞</label>
                    <input type="number" step="0.01" name="price" required value="${sub?.price || ''}">
                </div>
                <div class="form-group">
                    <label>–í–∞–ª—é—Ç–∞</label>
                    <select name="currency">
                        <option value="USD" ${sub?.currency === 'USD' ? 'selected' : ''}>USD ($)</option>
                        <option value="EUR" ${sub?.currency === 'EUR' ? 'selected' : ''}>EUR (‚Ç¨)</option>
                        <option value="RUB" ${sub?.currency === 'RUB' ? 'selected' : ''}>RUB (‚ÇΩ)</option>
                        <option value="GBP" ${sub?.currency === 'GBP' ? 'selected' : ''}>GBP (¬£)</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>–ü–µ—Ä–∏–æ–¥ –æ–ø–ª–∞—Ç—ã</label>
                <select name="billingCycle">
                    <option value="MONTHLY" ${sub?.billingCycle === 'MONTHLY' ? 'selected' : ''}>–†–∞–∑ –≤ –º–µ—Å—è—Ü</option>
                    <option value="YEARLY" ${sub?.billingCycle === 'YEARLY' ? 'selected' : ''}>–†–∞–∑ –≤ –≥–æ–¥</option>
                    <option value="WEEKLY" ${sub?.billingCycle === 'WEEKLY' ? 'selected' : ''}>–†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é</option>
                </select>
            </div>
            <div class="form-group">
                <label>–î–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è</label>
                <input type="date" name="startDate" required value="${sub?.startDate ? new Date(sub.startDate).toISOString().split('T')[0] : new Date().toISOString().split('T')[0]}">
            </div>
            <div style="background: var(--bg-color); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px dashed var(--primary-color);">
                <p style="font-weight: bold; margin-bottom: 0.5rem; color: var(--primary-color);">–ê–Ω—Ç–∏-—Ç—Ä–∏–∞–ª –ª–æ–≤—É—à–∫–∞</p>
                <div class="grid" style="grid-template-columns: 1fr 1fr;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–ö–æ–Ω–µ—Ü –ø—Ä–æ–º–æ-–ø–µ—Ä–∏–æ–¥–∞</label>
                        <input type="date" name="trialEndDate" value="${sub?.trialEndDate ? new Date(sub.trialEndDate).toISOString().split('T')[0] : ''}">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–¶–µ–Ω–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–º–æ</label>
                        <input type="number" step="0.01" name="trialPrice" placeholder="–ù–∞–ø—Ä. 9.99" value="${sub?.trialPrice || ''}">
                    </div>
                </div>
                <small style="display: block; margin-top: 0.5rem; color: var(--text-muted);">–ú—ã –Ω–∞–ø–æ–º–Ω–∏–º –≤–∞–º, –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ —Å–∫–æ—Ä–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è.</small>
            </div>
            <div style="background: var(--bg-color); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid var(--border-color);">
                <p style="font-weight: bold; margin-bottom: 0.5rem;">–°—Ç–∞—Ç—É—Å –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏</p>
                <div class="form-group">
                    <label>–ö–∞–∫ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ?</label>
                    <select name="utilityStatus">
                        <option value="ACTIVE" ${sub?.utilityStatus === 'ACTIVE' ? 'selected' : ''}>‚úÖ –ü–æ–ª—å–∑—É—é—Å—å –∞–∫—Ç–∏–≤–Ω–æ</option>
                        <option value="SOMETIMES" ${sub?.utilityStatus === 'SOMETIMES' ? 'selected' : ''}>üòê –ò–Ω–æ–≥–¥–∞</option>
                        <option value="NOT_USING" ${sub?.utilityStatus === 'NOT_USING' ? 'selected' : ''}>‚ùå –ù–µ –ø–æ–ª—å–∑—É—é—Å—å</option>
                    </select>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>–ö–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å?</label>
                    <input type="date" name="lastUsedAt" value="${sub?.lastUsedAt ? new Date(sub.lastUsedAt).toISOString().split('T')[0] : ''}">
                </div>
            </div>
            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–æ–ø—Ü.)</label>
                <input type="text" name="category" placeholder="Entertainment, Work..." value="${sub?.category || ''}">
            </div>
            ${sub && sub.id ? `
            <div class="form-group">
                <label>–°—Ç–∞—Ç—É—Å</label>
                <select name="isActive">
                    <option value="true" ${sub.isActive ? 'selected' : ''}>–ê–∫—Ç–∏–≤–Ω–∞</option>
                    <option value="false" ${!sub.isActive ? 'selected' : ''}>–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</option>
                </select>
            </div>
            ` : ''}
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button type="submit" class="btn btn-primary" style="flex: 1;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <a href="/app/subscriptions" class="btn" style="border: 1px solid var(--border-color); flex: 1; text-align: center;">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const nameParam = urlParams.get('name');
    if (nameParam && document.getElementById('serviceName')) {
        document.getElementById('serviceName').value = nameParam;
    }
</script>
`; %>
<%- include('../layout', { body: formBody }) %>
