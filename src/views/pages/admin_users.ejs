<% const adminUsersBody = `
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h2>Управление пользователями</h2>
    <a href="/app/admin" class="btn">Назад в панель</a>
</div>

<div class="card" style="padding: 0;">
    <table>
        <thead>
            <tr>
                <th>Email</th>
                <th>План</th>
                <th>Подписок</th>
                <th>Последний вход</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            ${users.map(u => `
                <tr>
                    <td>${u.email}</td>
                    <td>
                        <span class="badge" style="position: static; background: ${u.plan === 'PRO' ? 'var(--primary-color)' : 'var(--text-muted)'}">${u.plan}</span>
                    </td>
                    <td>${u._count.subscriptions}</td>
                    <td>${u.lastLoginAt ? new Date(u.lastLoginAt).toLocaleString('ru-RU') : 'Никогда'}</td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <form action="/app/admin/users/plan" method="POST" style="display: flex; gap: 0.5rem;">
                                <input type="hidden" name="userId" value="${u.id}">
                                <select name="plan" style="width: auto; padding: 0.2rem;">
                                    <option value="FREE" ${u.plan === 'FREE' ? 'selected' : ''}>FREE</option>
                                    <option value="PRO" ${u.plan === 'PRO' ? 'selected' : ''}>PRO</option>
                                </select>
                                <button type="submit" class="btn" style="padding: 0.2rem 0.5rem; font-size: 0.8rem; border: 1px solid var(--border-color);">Ок</button>
                            </form>
                            <form action="/app/admin/users/delete" method="POST" onsubmit="return confirm('Удалить пользователя и все его данные?')">
                                <input type="hidden" name="userId" value="${u.id}">
                                <button type="submit" class="btn btn-danger" style="padding: 0.2rem 0.5rem; font-size: 0.8rem;">Удалить</button>
                            </form>
                        </div>
                    </td>
                </tr>
            `).join('')}
        </tbody>
    </table>
</div>
`; %>
<%- include('../layout', { body: adminUsersBody }) %>
