<% const reportBody = `
<div style="max-width: 900px; margin: 0 auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2 style="margin: 0;">Годовой отчёт: ${report.year}</h2>
        <a href="/app/dashboard" class="btn" style="border: 1px solid var(--border-color);">Назад</a>
    </div>

    <div class="grid" style="margin-bottom: 2rem;">
        <div class="card" style="background: linear-gradient(135deg, var(--primary-color) 0%, #6366f1 100%); color: white; border: none;">
            <div class="stat-label" style="color: rgba(255,255,255,0.8);">Ориентировочные расходы за год</div>
            <div class="stat-val" style="font-size: 2.5rem;">${report.totalSpentYear} $</div>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.8;">* Расчёт на основе текущих активных подписок с начала года</p>
        </div>
        <div class="card">
            <div class="stat-label">Подписочная инфляция</div>
            <div class="stat-val" style="color: ${report.inflationDetails.length > 0 ? 'var(--danger)' : '#10b981'};">
                ${report.inflationDetails.length > 0 ? '+' + report.inflationDetails.length : '0'}
            </div>
            <p style="font-size: 0.8rem; margin-top: 0.5rem; color: var(--text-muted);">Сервисов подорожало в этом году</p>
        </div>
    </div>

    <div class="card">
        <h3 style="margin-bottom: 1.5rem;">История изменений цен (Инфляция)</h3>
        ${report.inflationDetails.length > 0 ? `
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Сервис</th>
                            <th>Было</th>
                            <th>Стало</th>
                            <th>Рост</th>
                            <th>История</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${report.inflationDetails.map(item => `
                            <tr>
                                <td><strong>${item.name}</strong></td>
                                <td>${item.oldPrice} ${item.currency}</td>
                                <td style="font-weight: bold; color: var(--danger);">${item.newPrice} ${item.currency}</td>
                                <td>
                                    <span style="background: #fee2e2; color: var(--danger); padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">
                                        +${item.percentage}%
                                    </span>
                                </td>
                                <td>
                                    <small style="color: var(--text-muted);">
                                        ${item.history.map(h => new Date(h.changedAt).toLocaleDateString('ru-RU')).join(', ')}
                                    </small>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        ` : `
            <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                <p>Ваши подписки стабильны! В этом году изменений цен не зафиксировано.</p>
            </div>
        `}
    </div>

    <div class="card" style="margin-top: 2rem;">
        <h3 style="margin-bottom: 1rem;">Советы по экономии</h3>
        <ul style="padding-left: 1.5rem; color: var(--text-muted); display: flex; flex-direction: column; gap: 0.5rem;">
            <li>Сервис подорожал? Проверьте, пользуетесь ли вы им так же часто, как раньше.</li>
            <li>Многие сервисы предлагают скидки при переходе с месячной на годовую оплату.</li>
            <li>Используйте наш <a href="/app/subscriptions">Симулятор экономии</a>, чтобы увидеть результат отказа от лишнего.</li>
        </ul>
    </div>
</div>
`; %>
<%- include('../layout', { body: reportBody }) %>
