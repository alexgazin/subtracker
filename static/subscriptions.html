<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubTracker - MVP</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <header class="main-header">
    <div class="container header-content">
        <div class="left-controls">
            <button id="menu-toggle" class="menu-toggle" aria-label="Open menu" aria-expanded="false">‚ò∞</button>
            <a href="./index.html" class="logo">SubTracker</a>
        </div>
        <nav class="nav">
            
                <!-- For logged in users keep header minimal: nav links are in sidebar -->
                <div class="header-actions">
                    <button class="theme-toggle" id="theme-toggle">üåô</button>
                </div>
            
        </nav>
    </div>
</header>


    <div class="app-layout">
        <aside id="sidebar" class="sidebar" aria-hidden="true" aria-label="Main navigation">
            <div class="sidebar-inner container">
                <div class="sidebar-controls">
                    <button id="sidebar-close" class="sidebar-close" aria-label="Close menu">‚úï</button>
                    <button id="sidebar-pin" class="sidebar-pin" aria-pressed="false" title="–ó–∞–∫—Ä–µ–ø–∏—Ç—å –º–µ–Ω—é">üìå</button>
                </div>
                <nav class="sidebar-nav">
                    
                        <a href="./dashboard.html" class="" ><span class="icon">üè†</span>–î–∞—à–±–æ—Ä–¥</a>
                        <a href="./inbox.html" class="" ><span class="icon">üì•</span>Inbox </a>
                        <a href="./subscriptions.html" class="" ><span class="icon">üìÑ</span>–ü–æ–¥–ø–∏—Å–∫–∏</a>
                        <a href="./app/annual-report.html" class="" ><span class="icon">üìä</span>–û—Ç—á—ë—Ç</a>
                        <a href="./notifications.html" class="" ><span class="icon">üîî</span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è <span class="badge">1</span></a>
                        <a href="./settings.html" class="" ><span class="icon">‚öôÔ∏è</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                        
                        <a href="./auth/logout.html"><span class="icon">‚Ü™Ô∏è</span>–í—ã—Ö–æ–¥</a>
                    
                </nav>
            </div>
        </aside>

        <div id="page-content" class="page-content container">
            

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubTracker - MVP</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <header class="main-header">
    <div class="container header-content">
        <div class="left-controls">
            <button id="menu-toggle" class="menu-toggle" aria-label="Open menu" aria-expanded="false">‚ò∞</button>
            <a href="./index.html" class="logo">SubTracker</a>
        </div>
        <nav class="nav">
            
                <!-- For logged in users keep header minimal: nav links are in sidebar -->
                <div class="header-actions">
                    <button class="theme-toggle" id="theme-toggle">üåô</button>
                </div>
            
        </nav>
    </div>
</header>


    <div class="app-layout">
        <aside id="sidebar" class="sidebar" aria-hidden="true" aria-label="Main navigation">
            <div class="sidebar-inner container">
                <div class="sidebar-controls">
                    <button id="sidebar-close" class="sidebar-close" aria-label="Close menu">‚úï</button>
                    <button id="sidebar-pin" class="sidebar-pin" aria-pressed="false" title="–ó–∞–∫—Ä–µ–ø–∏—Ç—å –º–µ–Ω—é">üìå</button>
                </div>
                <nav class="sidebar-nav">
                    
                        <a href="./dashboard.html" class="" ><span class="icon">üè†</span>–î–∞—à–±–æ—Ä–¥</a>
                        <a href="./inbox.html" class="" ><span class="icon">üì•</span>Inbox </a>
                        <a href="./subscriptions.html" class="" ><span class="icon">üìÑ</span>–ü–æ–¥–ø–∏—Å–∫–∏</a>
                        <a href="./app/annual-report.html" class="" ><span class="icon">üìä</span>–û—Ç—á—ë—Ç</a>
                        <a href="./notifications.html" class="" ><span class="icon">üîî</span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è <span class="badge">1</span></a>
                        <a href="./settings.html" class="" ><span class="icon">‚öôÔ∏è</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                        
                        <a href="./auth/logout.html"><span class="icon">‚Ü™Ô∏è</span>–í—ã—Ö–æ–¥</a>
                    
                </nav>
            </div>
        </aside>

        <div id="page-content" class="page-content container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;"><h2>–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏</h2><div style="display: flex; gap: 1rem; align-items: center;"><button id="toggleFavorites" class="btn" style="border: 1px solid var(--border-color); display: flex; align-items: center; gap: 0.5rem;"><span id="favIcon">ü§ç</span> –õ—é–±–∏–º—ã–µ</button><a href="./app/export-csv.html" class="btn" style="border: 1px solid var(--border-color);">–≠–∫—Å–ø–æ—Ä—Ç CSV</a><input type="text" id="subSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." style="width: 200px; padding: 0.4rem;"><a href="./subscriptions.html" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å</a></div></div><div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center;"><div><a href="./app/subscriptions?status=active&sortBy=date.html" class="btn " style="margin-right: 0.5rem;">–ê–∫—Ç–∏–≤–Ω—ã–µ</a><a href="./app/subscriptions?status=inactive&sortBy=date.html" class="btn " style="margin-right: 0.5rem;">–ê—Ä—Ö–∏–≤</a><a href="./app/subscriptions?status=all&sortBy=date.html" class="btn btn-primary">–í—Å–µ</a></div><div style="font-size: 0.9rem;">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ: <a href="./app/subscriptions?status=all&sortBy=date.html" style="margin-left: 0.5rem; color: var(--primary-color); font-weight: 600; text-decoration: none;">–î–∞—Ç–µ</a> <a href="./app/subscriptions?status=all&sortBy=price.html" style="margin-left: 0.5rem; color: inherit; font-weight: normal; text-decoration: none;">–°—Ç–æ–∏–º–æ—Å—Ç–∏</a></div></div><div class="ad-placeholder"><strong>–†–µ–∫–ª–∞–º–Ω—ã–π –±–ª–æ–∫</strong><br>–ó–¥–µ—Å—å –º–æ–≥–ª–∞ –±—ã—Ç—å –≤–∞—à–∞ —Ä–µ–∫–ª–∞–º–∞.</div><div class="card" style="padding: 0;"><div style="padding: 1rem; border-bottom: 1px solid var(--border-color); background: var(--bg-color); font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;"><input type="checkbox" id="selectAll" class="sub-checkbox"><label for="selectAll" style="margin: 0; cursor: pointer;"><strong>–°—Ü–µ–Ω–∞—Ä–∏–π —ç–∫–æ–Ω–æ–º–∏–∏:</strong> –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤—ã–≥–æ–¥—É –æ—Ç –æ—Ç–º–µ–Ω—ã</label></div><table><thead><tr><th style="width: 40px;"></th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th><th>–¶–∏–∫–ª</th><th>–°–ª–µ–¥. –æ–ø–ª–∞—Ç–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody><tr class="sub-row" data-favorite="false" style="" data-monthly="9.99" data-yearly="119.88"><td><input type="checkbox" class="sub-checkbox row-checkbox" data-id="1"></td><td><div style="display: flex; align-items: flex-start; gap: 0.5rem;"><button class="favorite-btn " data-id="1" title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">ü§ç</button><div><div style="display: flex; align-items: center; gap: 0.4rem;"><strong>Spotify</strong><span title="–ê–∫—Ç–∏–≤–Ω–æ –ø–æ–ª—å–∑—É—é—Å—å">‚úÖ</span></div><small style="color: var(--text-muted)"></small></div></div></td><td>9.99 $</td><td>–ú–µ—Å—è—Ü</td><td>29.01.2026</td><td><div style="display: flex; gap: 0.5rem;"><a href="./subscriptions.html" class="btn" style="padding: 0.2rem 0.5rem; font-size: 0.8rem; border: 1px solid var(--border-color);">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a><form action="/app/subscriptions/1/delete" method="POST" style="display: inline;" class="delete-sub-form"><button type="submit" class="btn btn-danger" style="padding: 0.2rem 0.5rem; font-size: 0.8rem;">–£–¥–∞–ª–∏—Ç—å</button></form></div></td></tr></tbody></table></div><div id="simulatorBar" class="simulator-bar"><div class="simulator-content"><div style="display: flex; flex-direction: column;"><strong id="selectedCount">–í—ã–±—Ä–∞–Ω–æ: 0</strong><span style="font-size: 0.8rem; color: var(--text-muted);">–°—Ü–µ–Ω–∞—Ä–∏–π –æ—Ç–º–µ–Ω—ã</span></div><div class="savings-info"><div class="savings-item"><span class="savings-label">–≠–∫–æ–Ω–æ–º–∏—è –≤ –º–µ—Å—è—Ü</span><span id="monthlySavings" class="savings-value">0.00 $</span></div><div class="savings-item"><span class="savings-label">–≠–∫–æ–Ω–æ–º–∏—è –≤ –≥–æ–¥</span><span id="yearlySavings" class="savings-value">0.00 $</span></div></div></div></div><script>document.addEventListener('DOMContentLoaded', () => { const searchInput = document.getElementById('subSearch'); const toggleFavoritesBtn = document.getElementById('toggleFavorites'); const favIcon = document.getElementById('favIcon'); let showOnlyFavorites = localStorage.getItem('showOnlyFavorites') === 'true'; if (showOnlyFavorites) { toggleFavoritesBtn && toggleFavoritesBtn.classList.add('btn-primary'); if(favIcon) favIcon.textContent = '‚ù§Ô∏è'; setTimeout(() => { if(window.filterRows) window.filterRows(); }, 0); } function filterRows() { const term = searchInput ? searchInput.value.toLowerCase() : ''; const rows = document.querySelectorAll('tbody tr.sub-row'); rows.forEach(row => { const nameCell = row.querySelector('td:nth-child(2) strong'); const isFavorite = row.getAttribute('data-favorite') === 'true'; if (nameCell) { const name = nameCell.textContent.toLowerCase(); const matchesSearch = name.includes(term); const matchesFavorite = !showOnlyFavorites || isFavorite; if (matchesSearch && matchesFavorite) { row.style.display = ''; } else { row.style.display = 'none'; } } }); updateSimulator(); } window.filterRows = filterRows; if (searchInput) { searchInput.addEventListener('input', filterRows); } if (toggleFavoritesBtn) { toggleFavoritesBtn.addEventListener('click', () => { showOnlyFavorites = !showOnlyFavorites; localStorage.setItem('showOnlyFavorites', showOnlyFavorites); if (showOnlyFavorites) { toggleFavoritesBtn.classList.add('btn-primary'); if(favIcon) favIcon.textContent = '‚ù§Ô∏è'; } else { toggleFavoritesBtn.classList.remove('btn-primary'); if(favIcon) favIcon.textContent = 'ü§ç'; } filterRows(); }); } document.querySelectorAll('.favorite-btn').forEach(btn => { btn.addEventListener('click', async (e) => { e.preventDefault(); const id = btn.getAttribute('data-id'); btn.disabled = true; try { const res = await fetch('/app/subscriptions/' + id + '/toggle-favorite', { method: 'POST', headers: { 'Content-Type': 'application/json' } }); const data = await res.json(); if (data.success) { btn.classList.toggle('active', data.isFavorite); btn.textContent = data.isFavorite ? '‚ù§Ô∏è' : 'ü§ç'; const row = btn.closest('tr'); row.setAttribute('data-favorite', data.isFavorite); if (showOnlyFavorites && !data.isFavorite) { filterRows(); } } } catch (err) { console.error('Error toggling favorite:', err); } finally { btn.disabled = false; } }); }); // simulator logic
    const selectAll = document.getElementById('selectAll'); const rowCheckboxes = document.querySelectorAll('.row-checkbox'); const simulatorBar = document.getElementById('simulatorBar'); const monthlySavingsEl = document.getElementById('monthlySavings'); const yearlySavingsEl = document.getElementById('yearlySavings'); const selectedCountEl = document.getElementById('selectedCount'); function updateSimulator() { let monthlyTotal = 0; let yearlyTotal = 0; let count = 0; rowCheckboxes.forEach(cb => { if (cb.checked) { const row = cb.closest('tr'); monthlyTotal += parseFloat(row.dataset.monthly || 0); yearlyTotal += parseFloat(row.dataset.yearly || 0); count++; } }); if (count > 0) { simulatorBar && (simulatorBar.style.display = 'block'); monthlySavingsEl && (monthlySavingsEl.textContent = monthlyTotal.toFixed(2) + ' $'); yearlySavingsEl && (yearlySavingsEl.textContent = yearlyTotal.toFixed(2) + ' $'); selectedCountEl && (selectedCountEl.textContent = '–í—ã–±—Ä–∞–Ω–æ: ' + count); } else { simulatorBar && (simulatorBar.style.display = 'none'); } } if (selectAll) { selectAll.addEventListener('change', () => { rowCheckboxes.forEach(cb => { if (cb.closest('tr').style.display !== 'none') { cb.checked = selectAll.checked; } }); updateSimulator(); }); } rowCheckboxes.forEach(cb => { cb.addEventListener('change', updateSimulator); }); document.querySelectorAll('.delete-sub-form').forEach(form => { form.addEventListener('submit', (e) => { if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É?')) { e.preventDefault(); } }); }); });</script>
        </div>
    </div>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2026 SubTracker MVP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script>
        // Theme toggle
        const toggle = document.getElementById('theme-toggle');
        const currentTheme = localStorage.getItem('theme') || 'light';
        if (currentTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            if (toggle) toggle.textContent = '‚òÄÔ∏è';
        }
        if (toggle) toggle.addEventListener('click', () => {
            let theme = document.documentElement.getAttribute('data-theme');
            if (theme === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                toggle.textContent = 'üåô';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                toggle.textContent = '‚òÄÔ∏è';
            }
        });

        // Sidebar toggle + pin
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebar-close');
        const sidebarPin = document.getElementById('sidebar-pin');
        const pageContent = document.getElementById('page-content');

        const SIDEBAR_PIN_KEY = 'sidebarPinned';

        function applyPinnedState() {
            try {
                const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
                if (pinned && window.innerWidth >= 900) {
                    sidebar.classList.add('pinned');
                    sidebar.classList.add('open');
                    sidebar.setAttribute('aria-hidden', 'false');
                    document.body.classList.add('sidebar-pinned');
                    if (sidebarPin) sidebarPin.setAttribute('aria-pressed', 'true');
                } else {
                    sidebar.classList.remove('pinned');
                    if (!sidebar.classList.contains('open')) sidebar.setAttribute('aria-hidden', 'true');
                    document.body.classList.remove('sidebar-pinned');
                    if (sidebarPin) sidebarPin.setAttribute('aria-pressed', 'false');
                }
            } catch (e) { console.error(e); }
        }

        function openSidebar() {
            sidebar.classList.add('open');
            sidebar.setAttribute('aria-hidden', 'false');
            document.body.classList.add('no-scroll');
            if (menuToggle) menuToggle.setAttribute('aria-expanded','true');
            const firstLink = sidebar.querySelector('a');
            if (firstLink) firstLink.focus();
        }

        function closeSidebar() {
            // do not close if pinned on desktop
            const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
            if (pinned && window.innerWidth >= 900) return;

            sidebar.classList.remove('open');
            sidebar.setAttribute('aria-hidden', 'true');
            document.body.classList.remove('no-scroll');
            if (menuToggle) menuToggle.setAttribute('aria-expanded','false');
            if (menuToggle) menuToggle.focus();
        }

        function togglePin() {
            const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
            const newVal = !pinned;
            localStorage.setItem(SIDEBAR_PIN_KEY, newVal ? 'true' : 'false');
            applyPinnedState();
        }

        if (menuToggle) menuToggle.addEventListener('click', openSidebar);
        if (sidebarClose) sidebarClose.addEventListener('click', closeSidebar);
        if (sidebarPin) sidebarPin.addEventListener('click', togglePin);

        // close on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && sidebar.classList.contains('open')) closeSidebar();
        });

        // click outside to close (on overlays)
        pageContent && pageContent.addEventListener('click', (e) => {
            if (sidebar.classList.contains('open') && !sidebar.classList.contains('pinned')) closeSidebar();
        });

        // on resize apply pinned state (if pinned becomes irrelevant on small screens)
        window.addEventListener('resize', applyPinnedState);

        // initial apply
        applyPinnedState();
    </script>
</body>
</html>


        </div>
    </div>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2026 SubTracker MVP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script>
        // Theme toggle
        const toggle = document.getElementById('theme-toggle');
        const currentTheme = localStorage.getItem('theme') || 'light';
        if (currentTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            if (toggle) toggle.textContent = '‚òÄÔ∏è';
        }
        if (toggle) toggle.addEventListener('click', () => {
            let theme = document.documentElement.getAttribute('data-theme');
            if (theme === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                toggle.textContent = 'üåô';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                toggle.textContent = '‚òÄÔ∏è';
            }
        });

        // Sidebar toggle + pin
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebar-close');
        const sidebarPin = document.getElementById('sidebar-pin');
        const pageContent = document.getElementById('page-content');

        const SIDEBAR_PIN_KEY = 'sidebarPinned';

        function applyPinnedState() {
            try {
                const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
                if (pinned && window.innerWidth >= 900) {
                    sidebar.classList.add('pinned');
                    sidebar.classList.add('open');
                    sidebar.setAttribute('aria-hidden', 'false');
                    document.body.classList.add('sidebar-pinned');
                    if (sidebarPin) sidebarPin.setAttribute('aria-pressed', 'true');
                } else {
                    sidebar.classList.remove('pinned');
                    if (!sidebar.classList.contains('open')) sidebar.setAttribute('aria-hidden', 'true');
                    document.body.classList.remove('sidebar-pinned');
                    if (sidebarPin) sidebarPin.setAttribute('aria-pressed', 'false');
                }
            } catch (e) { console.error(e); }
        }

        function openSidebar() {
            sidebar.classList.add('open');
            sidebar.setAttribute('aria-hidden', 'false');
            document.body.classList.add('no-scroll');
            if (menuToggle) menuToggle.setAttribute('aria-expanded','true');
            const firstLink = sidebar.querySelector('a');
            if (firstLink) firstLink.focus();
        }

        function closeSidebar() {
            // do not close if pinned on desktop
            const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
            if (pinned && window.innerWidth >= 900) return;

            sidebar.classList.remove('open');
            sidebar.setAttribute('aria-hidden', 'true');
            document.body.classList.remove('no-scroll');
            if (menuToggle) menuToggle.setAttribute('aria-expanded','false');
            if (menuToggle) menuToggle.focus();
        }

        function togglePin() {
            const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
            const newVal = !pinned;
            localStorage.setItem(SIDEBAR_PIN_KEY, newVal ? 'true' : 'false');
            applyPinnedState();
        }

        if (menuToggle) menuToggle.addEventListener('click', openSidebar);
        if (sidebarClose) sidebarClose.addEventListener('click', closeSidebar);
        if (sidebarPin) sidebarPin.addEventListener('click', togglePin);

        // close on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && sidebar.classList.contains('open')) closeSidebar();
        });

        // click outside to close (on overlays)
        pageContent && pageContent.addEventListener('click', (e) => {
            if (sidebar.classList.contains('open') && !sidebar.classList.contains('pinned')) closeSidebar();
        });

        // on resize apply pinned state (if pinned becomes irrelevant on small screens)
        window.addEventListener('resize', applyPinnedState);

        // initial apply
        applyPinnedState();
    </script>
</body>
</html>
