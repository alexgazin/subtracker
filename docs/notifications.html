<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubTracker - MVP</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <header class="main-header">
    <div class="container header-content">
        <div class="left-controls">
            <button id="menu-toggle" class="menu-toggle" aria-label="Open menu" aria-expanded="false">‚ò∞</button>
            <a href="./index.html" class="logo">SubTracker</a>
        </div>
        <nav class="nav">
            
                <!-- For logged in users keep header minimal: nav links are in sidebar -->
                <div class="header-actions">
                    <button class="theme-toggle" id="theme-toggle">üåô</button>
                </div>
            
        </nav>
    </div>
</header>


    <div class="app-layout">
        <aside id="sidebar" class="sidebar" aria-hidden="true" aria-label="Main navigation">
            <div class="sidebar-inner container">
                <div class="sidebar-controls">
                    <button id="sidebar-close" class="sidebar-close" aria-label="Close menu">‚úï</button>
                    <button id="sidebar-pin" class="sidebar-pin" aria-pressed="false" title="–ó–∞–∫—Ä–µ–ø–∏—Ç—å –º–µ–Ω—é">üìå</button>
                </div>
                <nav class="sidebar-nav">
                    
                        <a href="./dashboard.html" class="" ><span class="icon">üè†</span>–î–∞—à–±–æ—Ä–¥</a>
                        <a href="./inbox.html" class="" ><span class="icon">üì•</span>Inbox </a>
                        <a href="./subscriptions.html" class="" ><span class="icon">üìÑ</span>–ü–æ–¥–ø–∏—Å–∫–∏</a>
                        <a href="./app/annual-report.html" class="" ><span class="icon">üìä</span>–û—Ç—á—ë—Ç</a>
                        <a href="./notifications.html" class="" ><span class="icon">üîî</span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è <span class="badge">1</span></a>
                        <a href="./settings.html" class="" ><span class="icon">‚öôÔ∏è</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                        
                        <a href="./auth/logout.html"><span class="icon">‚Ü™Ô∏è</span>–í—ã—Ö–æ–¥</a>
                    
                </nav>
            </div>
        </aside>

        <div id="page-content" class="page-content container">
            
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubTracker - MVP</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <header class="main-header">
    <div class="container header-content">
        <div class="left-controls">
            <button id="menu-toggle" class="menu-toggle" aria-label="Open menu" aria-expanded="false">‚ò∞</button>
            <a href="./index.html" class="logo">SubTracker</a>
        </div>
        <nav class="nav">
            
                <!-- For logged in users keep header minimal: nav links are in sidebar -->
                <div class="header-actions">
                    <button class="theme-toggle" id="theme-toggle">üåô</button>
                </div>
            
        </nav>
    </div>
</header>


    <div class="app-layout">
        <aside id="sidebar" class="sidebar" aria-hidden="true" aria-label="Main navigation">
            <div class="sidebar-inner container">
                <div class="sidebar-controls">
                    <button id="sidebar-close" class="sidebar-close" aria-label="Close menu">‚úï</button>
                    <button id="sidebar-pin" class="sidebar-pin" aria-pressed="false" title="–ó–∞–∫—Ä–µ–ø–∏—Ç—å –º–µ–Ω—é">üìå</button>
                </div>
                <nav class="sidebar-nav">
                    
                        <a href="./dashboard.html" class="" ><span class="icon">üè†</span>–î–∞—à–±–æ—Ä–¥</a>
                        <a href="./inbox.html" class="" ><span class="icon">üì•</span>Inbox </a>
                        <a href="./subscriptions.html" class="" ><span class="icon">üìÑ</span>–ü–æ–¥–ø–∏—Å–∫–∏</a>
                        <a href="./app/annual-report.html" class="" ><span class="icon">üìä</span>–û—Ç—á—ë—Ç</a>
                        <a href="./notifications.html" class="" ><span class="icon">üîî</span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è <span class="badge">1</span></a>
                        <a href="./settings.html" class="" ><span class="icon">‚öôÔ∏è</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                        
                        <a href="./auth/logout.html"><span class="icon">‚Ü™Ô∏è</span>–í—ã—Ö–æ–¥</a>
                    
                </nav>
            </div>
        </aside>

        <div id="page-content" class="page-content container">
            
<div style="max-width: 800px; margin: 0 auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2 style="margin: 0;">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
        
            <button id="mark-all-read-btn" class="btn btn-primary" style="font-size: 0.9rem;">–ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ</button>
        
    </div>
    <div id="notifications-container" style="margin-top: 1.5rem;">
        
            <div id="notif-1" class="card notification-card unread" style="border-left: 4px solid var(--primary-color); opacity: 1; transition: all 0.3s ease;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <h4 style="margin: 0;">–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h4>
                        <p style="margin: 0.5rem 0;">–≠—Ç–æ —Ç–µ—Å—Ç.</p>
                        <small style="color: var(--text-muted)">29.01.2026, 13:34:12</small>
                    </div>
                    <button class="remove-btn" data-id="1" data-is-read="false" class="btn" style="font-size: 1.5rem; color: var(--text-muted); background: none; border: none; cursor: pointer; line-height: 1; padding: 0.5rem; margin: -0.5rem -0.5rem 0 0;" aria-label="–£–¥–∞–ª–∏—Ç—å">&times;</button>
                </div>
            </div>
        
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
    const container = document.getElementById('notifications-container');
    if (container) {
        container.addEventListener('click', (e) => {
            const removeBtn = e.target.closest('.remove-btn');
            if (removeBtn) {
                const id = removeBtn.getAttribute('data-id');
                const isRead = removeBtn.getAttribute('data-is-read') === 'true';
                removeNotification(id, isRead);
            }
        });
    }

    // –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ"
    const markAllBtn = document.getElementById('mark-all-read-btn');
    if (markAllBtn) {
        markAllBtn.addEventListener('click', markAllRead);
    }
});

async function removeNotification(id, isRead) {
    const card = document.getElementById('notif-' + id);
    if (!card) return;
    
    const btn = card.querySelector('.remove-btn');
    if (btn) btn.disabled = true;

    try {
        const res = await fetch('/app/notifications/' + id, { 
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' }
        });
        
        if (!res.ok) throw new Error('Failed to delete notification');
        
        if (!isRead) {
            const badge = document.querySelector('.badge');
            if (badge) {
                const count = parseInt(badge.innerText.trim()) - 1;
                if (count <= 0) {
                    badge.remove();
                } else {
                    badge.innerText = count;
                }
            }
        }
        
        card.style.opacity = '0';
        card.style.transform = 'translateX(20px)';
        setTimeout(() => {
            card.remove();
            checkEmptyState();
        }, 300);
    } catch (err) {
        console.error('Error:', err);
        if (btn) btn.disabled = false;
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    }
}

async function markAllRead() {
    const markAllBtn = document.getElementById('mark-all-read-btn');
    if (markAllBtn) markAllBtn.disabled = true;

    try {
        const res = await fetch('/app/notifications/mark-all-read', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        });
        
        if (res.ok) {
            const container = document.getElementById('notifications-container');
            const allCards = container.querySelectorAll('.notification-card');
            
            allCards.forEach(card => {
                card.style.opacity = '0.5';
            });

            setTimeout(() => {
                allCards.forEach(card => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(-10px)';
                });
                
                setTimeout(() => {
                    container.innerHTML = '<div id="no-notifications" style="text-align: center; color: var(--text-muted); padding: 2rem;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.</div>';
                    if (markAllBtn) markAllBtn.remove();
                }, 300);
            }, 500);

            const badge = document.querySelector('.badge');
            if (badge) badge.remove();
        } else {
             if (markAllBtn) markAllBtn.disabled = false;
        }
    } catch (err) {
        console.error('Error:', err);
        if (markAllBtn) markAllBtn.disabled = false;
    }
}

function checkEmptyState() {
    const container = document.getElementById('notifications-container');
    if (container && container.querySelectorAll('.notification-card').length === 0) {
        container.innerHTML = '<div id="no-notifications" style="text-align: center; color: var(--text-muted); padding: 2rem;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.</div>';
        const markAllBtn = document.getElementById('mark-all-read-btn');
        if (markAllBtn) markAllBtn.remove();
    }
}
</script>

        </div>
    </div>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2026 SubTracker MVP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script>
        // Theme toggle
        const toggle = document.getElementById('theme-toggle');
        const currentTheme = localStorage.getItem('theme') || 'light';
        if (currentTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            if (toggle) toggle.textContent = '‚òÄÔ∏è';
        }
        if (toggle) toggle.addEventListener('click', () => {
            let theme = document.documentElement.getAttribute('data-theme');
            if (theme === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                toggle.textContent = 'üåô';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                toggle.textContent = '‚òÄÔ∏è';
            }
        });

        // Sidebar toggle + pin
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebar-close');
        const sidebarPin = document.getElementById('sidebar-pin');
        const pageContent = document.getElementById('page-content');

        const SIDEBAR_PIN_KEY = 'sidebarPinned';

        function applyPinnedState() {
            try {
                const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
                if (pinned && window.innerWidth >= 900) {
                    sidebar.classList.add('pinned');
                    sidebar.classList.add('open');
                    sidebar.setAttribute('aria-hidden', 'false');
                    document.body.classList.add('sidebar-pinned');
                    if (sidebarPin) sidebarPin.setAttribute('aria-pressed', 'true');
                } else {
                    sidebar.classList.remove('pinned');
                    if (!sidebar.classList.contains('open')) sidebar.setAttribute('aria-hidden', 'true');
                    document.body.classList.remove('sidebar-pinned');
                    if (sidebarPin) sidebarPin.setAttribute('aria-pressed', 'false');
                }
            } catch (e) { console.error(e); }
        }

        function openSidebar() {
            sidebar.classList.add('open');
            sidebar.setAttribute('aria-hidden', 'false');
            document.body.classList.add('no-scroll');
            if (menuToggle) menuToggle.setAttribute('aria-expanded','true');
            const firstLink = sidebar.querySelector('a');
            if (firstLink) firstLink.focus();
        }

        function closeSidebar() {
            // do not close if pinned on desktop
            const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
            if (pinned && window.innerWidth >= 900) return;

            sidebar.classList.remove('open');
            sidebar.setAttribute('aria-hidden', 'true');
            document.body.classList.remove('no-scroll');
            if (menuToggle) menuToggle.setAttribute('aria-expanded','false');
            if (menuToggle) menuToggle.focus();
        }

        function togglePin() {
            const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
            const newVal = !pinned;
            localStorage.setItem(SIDEBAR_PIN_KEY, newVal ? 'true' : 'false');
            applyPinnedState();
        }

        if (menuToggle) menuToggle.addEventListener('click', openSidebar);
        if (sidebarClose) sidebarClose.addEventListener('click', closeSidebar);
        if (sidebarPin) sidebarPin.addEventListener('click', togglePin);

        // close on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && sidebar.classList.contains('open')) closeSidebar();
        });

        // click outside to close (on overlays)
        pageContent && pageContent.addEventListener('click', (e) => {
            if (sidebar.classList.contains('open') && !sidebar.classList.contains('pinned')) closeSidebar();
        });

        // on resize apply pinned state (if pinned becomes irrelevant on small screens)
        window.addEventListener('resize', applyPinnedState);

        // initial apply
        applyPinnedState();
    </script>
</body>
</html>


        </div>
    </div>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2026 SubTracker MVP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script>
        // Theme toggle
        const toggle = document.getElementById('theme-toggle');
        const currentTheme = localStorage.getItem('theme') || 'light';
        if (currentTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            if (toggle) toggle.textContent = '‚òÄÔ∏è';
        }
        if (toggle) toggle.addEventListener('click', () => {
            let theme = document.documentElement.getAttribute('data-theme');
            if (theme === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                toggle.textContent = 'üåô';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                toggle.textContent = '‚òÄÔ∏è';
            }
        });

        // Sidebar toggle + pin
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebar-close');
        const sidebarPin = document.getElementById('sidebar-pin');
        const pageContent = document.getElementById('page-content');

        const SIDEBAR_PIN_KEY = 'sidebarPinned';

        function applyPinnedState() {
            try {
                const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
                if (pinned && window.innerWidth >= 900) {
                    sidebar.classList.add('pinned');
                    sidebar.classList.add('open');
                    sidebar.setAttribute('aria-hidden', 'false');
                    document.body.classList.add('sidebar-pinned');
                    if (sidebarPin) sidebarPin.setAttribute('aria-pressed', 'true');
                } else {
                    sidebar.classList.remove('pinned');
                    if (!sidebar.classList.contains('open')) sidebar.setAttribute('aria-hidden', 'true');
                    document.body.classList.remove('sidebar-pinned');
                    if (sidebarPin) sidebarPin.setAttribute('aria-pressed', 'false');
                }
            } catch (e) { console.error(e); }
        }

        function openSidebar() {
            sidebar.classList.add('open');
            sidebar.setAttribute('aria-hidden', 'false');
            document.body.classList.add('no-scroll');
            if (menuToggle) menuToggle.setAttribute('aria-expanded','true');
            const firstLink = sidebar.querySelector('a');
            if (firstLink) firstLink.focus();
        }

        function closeSidebar() {
            // do not close if pinned on desktop
            const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
            if (pinned && window.innerWidth >= 900) return;

            sidebar.classList.remove('open');
            sidebar.setAttribute('aria-hidden', 'true');
            document.body.classList.remove('no-scroll');
            if (menuToggle) menuToggle.setAttribute('aria-expanded','false');
            if (menuToggle) menuToggle.focus();
        }

        function togglePin() {
            const pinned = localStorage.getItem(SIDEBAR_PIN_KEY) === 'true';
            const newVal = !pinned;
            localStorage.setItem(SIDEBAR_PIN_KEY, newVal ? 'true' : 'false');
            applyPinnedState();
        }

        if (menuToggle) menuToggle.addEventListener('click', openSidebar);
        if (sidebarClose) sidebarClose.addEventListener('click', closeSidebar);
        if (sidebarPin) sidebarPin.addEventListener('click', togglePin);

        // close on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && sidebar.classList.contains('open')) closeSidebar();
        });

        // click outside to close (on overlays)
        pageContent && pageContent.addEventListener('click', (e) => {
            if (sidebar.classList.contains('open') && !sidebar.classList.contains('pinned')) closeSidebar();
        });

        // on resize apply pinned state (if pinned becomes irrelevant on small screens)
        window.addEventListener('resize', applyPinnedState);

        // initial apply
        applyPinnedState();
    </script>
</body>
</html>
